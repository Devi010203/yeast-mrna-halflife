### The programs in this folder are dependent on the main program, please make sure you have run the main program and change the paths to the relevant files in the relevant scripts.

### gene_isoform_correlation_analysis_config.py
- **Functionality**:
  
  Based on the prediction results of the test set, the predicted files are automatically matched with the original mRNA half-life dataset by sequence, and unified into the “gene-isoform” framework for a posteriori analysis. The script organizes the true and predicted values at the isoform level, calculates the median half-life and prediction deviation of each gene, and constructs various correlation and R² metrics, such as overall / cross-gene / within-gene / bias-vs-iso, for the "within-gene decentralized correlation We also construct overall / cross-gene / within-gene / biasvs-iso correlation and R² metrics to provide standard input for the “within-gene decentralized correlation” and “cross-gene median baseline” analyses in the paper and subsequent mapping scripts. :contentReference[oaicite:0]{index=0}
  

- **Primary Inputs**:
  
  - `CONFIG[“dataset”]`: raw mRNA half-life dataset (CSV) containing columns for gene IDs, 3′UTR sequences, and true half-lives (column names can be automatically recognized or explicitly specified in CONFIG).
  
  - `CONFIG[“predictions”]`: predictions of the model on an independent test set (CSV), containing columns for sequences and predictions, optionally containing columns for true values.
  
  - Column names in `CONFIG` with options:
  
    - `dataset_seq_col` / `pred_seq_col`: sequence columns to be used for matching (auto-detect when empty).
  
    - `dataset_gene_col`: column for gene identifiers (auto-detected when empty).
  
    - `dataset_true_col` / `pred_true_col`: true half-life column source.
  
    - `pred_pred_col`: predicted value column name.
  
    - `map_u_to_t`: whether to harmonize U→T to DNA format before matching.
  
    - `outdir`: result output directory.
  
    - `plots`: whether to additionally generate base scatterplot (PNG+SVG).

- **Main output** (written to `CONFIG[“outdir”]` directory):
  
  - `analysis_per_isoform.csv`:
  
    - Tables organized by isoform (sequence), contains:
  
      - `gene`, `ios_real` (real values), `ios_pre` (predicted values)
  
      - Gene level median `ref_real` / `ref_pre` and its difference `delta_ref`        - Decentering bias `d_real` / `d_pre`, isoform error `delta_iso`        - Flag `ambiguous_seq` if the sequence corresponds to more than one gene in the original dataset.
  
  - `per_gene_summary.csv`:
  
    - A table aggregated by gene giving the true/predicted median, number of isoforms, and intra-gene Pearson / Spearman / R² metrics for each gene.
  
  - `cross_gene_median.csv`:
  
    - The true median `ref_real` and predicted median `ref_pred` for each gene, and the number of observations `n`, used to construct the cross-baseline scatter and R² fit.
  
  - `metrics_summary.json`:
  
    - Global summary metrics (overall, cross-gene, within-gene pooled, bias vs isoform, and per-gene related macro-averages, medians, Fisher-z weighted means, etc.).
  
  - `matching_log.txt`:
  
    - Matching and data quality diagnostics (row counts, fuzzy column name parsing results, missing cases, number of ambiguous sequences, etc.).
  
  - Also generated if `CONFIG[“plots”] = True`:
  
    - `scatter_cross_gene.(png/svg)`: scatter plot of true/predicted median at gene level.
  
    - `scatter_within_gene.(png/svg)`: decentralized within-gene scatterplot.
  
    - `scatter_bias_vs_iso.(png/svg)`: gene bias vs iso error scatterplot.

- **How to use**:
  
  1. Modify the `CONFIG` dictionary at the top of the script according to the actual file path and column names.
  
  2. Run it in a terminal:
  
     ``bash     python gene_isoform_correlation_analysis_config.py     ``    3. All results will be output to the directory specified by `CONFIG[“outdir”]`, which can be used as data input for subsequent mapping and thesis analysis.


---

### plot_within_gene_supplement.py
- **Functional role**:
  
  Reads the result file generated by `gene_isoform_correlation_analysis_config.py` and automatically plots both types of images in the supplement:
  
  - **Sx: a gene-by-gene correlation distribution plot** (violin + boxline + jitter scatter) showing the distribution of within-gene decentered Pearson/Spearman correlation coefficients across all genes with macro-mean, median, Fisher-z weighted mean, and pooled within-gene Pearson given at the corner markers simultaneously.
  
  - **Sy: cross-gene median scatterplot** showing the true median vs predicted median at the gene level, with the y=x baseline superimposed on a linearly fitted straight line for demonstrating the cross-gene baseline fit. :contentReference[oaicite:1]{index=1}
  

- **Primary input** (specified via a constant at the top of the script):
  
  - `PER_GENE_CSV`: `per_gene_summary.csv`, from which gene-by-gene Pearson/Spearman correlation coefficients and the number of isoforms are preferentially read.
  
  - `CROSS_GENE_CSV`: `cross_gene_median.csv`, prioritize reading gene level true/predicted median from it.
  
  - `PER_ISOFORM_CSV`: `analysis_per_isoform.csv`, used for on-the-spot recalculation of within-gene correlation or gene median by gene when the above information is missing.
  
  - `OUTDIR`: image output directory.

- **Main output** (written to `OUTDIR` directory):
  
  - `per_gene_corr_violin.(png/svg)`:
  
    - Violin + boxplot of gene-by-gene Pearson/Spearman correlation distributions with macro-mean, macro-median, Fisher-z weighted mean, and pooled within-gene Pearson text labeled within the plot.
  
  - `per_gene_corr_box_jitter.(png/svg)`:
  
    - Box line plot of per-gene correlation distribution superimposed on jitter scatter points, each point corresponds to the correlation coefficient of one gene, used to visualize the gene layer distribution more intuitively.
  
  - `cross_gene_median_scatter.(png/svg)`:
  
    - Scatter plot of true median vs predicted median for gene layers, plotted with y=x reference line and least squares fit straight line, and displayed in 1:1 scale coordinate system, used to complement the cross-gene baseline fit.

- **How to use**:
  
  1. Change `PER_GENE_CSV`, `CROSS_GENE_CSV`, `PER_ISOFORM_CSV` to the path of the actual generated file, and `OUTDIR` to the desired output directory.
  
  2. Ensure that dependencies such as `matplotlib` and `scienceplots` are installed.
  
  3. Run it in a terminal:
  
     ``bash     python plot_within_gene_supplement.py     ``    4. The script automatically generates the Sx/Sy image files required for the supplement in ``OUTDIR''.