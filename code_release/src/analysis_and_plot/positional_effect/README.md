### The programs in this folder are dependent on the main program, please make sure you have run the main program and changed the paths to the relevant files in the relevant scripts.

### plot_positional_effects-rel.py (relative FP32 cached version)

- **Functional effects**:
  
  Perform sliding window occlusion (occlusion) experiments on test set sequences based on the final trained mRNA half-life prediction model to calculate relative positional effects
  
  \[
  r\Delta = \frac{\text{baseline} - \text{occluded}}{\text{baseline}}
  
\]  
  Use FP32 precision throughout, and fully cache baseline predictions with occlusion results for each window into `result/cache/positional_effects_rel/<RUN_NAME>/`, with support for breakpoints and “aggregate plotting-only” mode; then aggregate to get Overall relative position effect curves, segmented bar charts, Top-K heatmaps, and optional length-stratified curves are then aggregated to obtain the overall relative position effect curves, segmented bar charts, Top-K heatmaps and optional length-stratified curves.

- **Main input**:
  
  - Model and data paths (specified in `CONFIG`):
  
    - `MODEL_CODE_PATH`: main training script path (provide `Config`, model class and `get_device`, with `collate_fn_no_chunk` preferred for reuse if available);
  
    - `RUN_DIR`: training results directory (must contain `final_test_predictions.csv`, provide `sequence` column);
  
    - `CKPT_PATH`: the trained weights file (e.g. `best_model_final.pth`);
  
    - `LOCAL_TOKENIZER_DIR`, `LOCAL_RNAFM_DIR`: local RNA-FM tokenizer and model directories.
  
  - Masking and sampling settings: e.g. `SUBSET_N` (number of sequences involved in masking), `WINDOW_SIZE`, `WINDOW_STEP`, `FILL_CHAR`, etc;
  
  
- Inference and mapping parameters: such as `BATCH_SIZE`, `NORM_POS_BINS`, `TOP_HEATMAP_K`, `DO_LENGTH_STRATA`, `LENGTH_BINS_ABS` / `LENGTH_QUANTILES`, `DPI`, `FIGSIZE_ CURVE`, `FIGSIZE_HEATMAP`, etc;  
  - Mode of operation: `MODE` optional `“all”` (compute+plot), `‘compute_only’` (generate/complete cache only), `“aggregate_only”` (aggregate and plot from cache only).

- **Main output**:
  
  1. **Cache (`result/cache/positional_effects_rel/<RUN_NAME>/`) **       - `meta.json`: records key information such as window size, step size, number of bins, mask characters, batch size, model path, etc;
  
     - `baseline.csv`: baseline predictions, sequence length, sequence md5, etc. for each sample;
  
     - `occl/seq_XXXXXX.csv`: `start`, `center`, `occ_pred`, `delta` with relative effect `rel` for all masking windows for each sample.

  2. **Aggregate results with images (`result/plot/positional_effects_rel/<timestamp>/`)**       - Relative positional effects overall curve (mean ± 95% CI) and corresponding CSV;
  
     - 0-0.2...0.8-1.0 segmented mean bar graphs and CSVs (with significance asterisks);
  
     - Relative effect position heatmaps and CSVs for Top-K sequences;
  
     - If length stratification is enabled, relative position effect curves and corresponding CSVs for different length strata are also output.


---
### plot_positional_effects_absolute_from_cache.py

- **Functionality**:
  
  From the existing occluded cache results (`result/cache/positional_effects_rel/<RUN_NAME>/`), aggregate the occluded effects across samples at different positions `Δ = baseline - occluded`, with **no more calls to the model, just CPU**, and plot the overall positional effect curve and corresponding CSV. occluded`, plotting overall “absolute position effect” curves, segmented mean bar charts, Top-K sequence heatmaps, and optionally curves stratified by 3′ UTR length to show the average effect of occlusion at different relative positions on the predicted half-life.

- **Main Input**:
  
  - `CONFIG[“CACHE_DIR”]`: the cache directory generated by the RELATIVE version of the script, containing:
    - `meta.json`: meta information such as window size, step size, number of bins, etc;
    - `baseline.csv`: baseline predictions and length for each sequence;
    - `occl/seq_XXXXXX.csv`: information such as `center` and `delta` of each window of each sequence.
  - Position and mapping parameters: such as `NORM_POS_BINS`, `TOP_HEATMAP_K`, `DO_LENGTH_STRATA`, `LENGTH_BINS_ABS` / `LENGTH_QUANTILES`, `DPI`, `FIGSIZE_CURVE`, `FIGSIZE_ HEATMAP` etc.

- **Primary output** (written to `result/plot/positional_effects_abs/<timestamp>/` by default):
  
  - Absolute positional effects overall curve and corresponding CSV (mean ± 95% CI);
  
  - The overall absolute position effect curve and corresponding CSV (mean ± 95% CI); the 0-0.2...0.8-1.0 bins mean bar chart and CSV (significant bins are marked with an asterisk);
  
  - Heatmap of absolute effect location and CSV for Top-K sequence;
  
  - If length stratification is enabled, the absolute position effect curves and corresponding CSVs for different length strata will also be output.